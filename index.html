<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soporte Pro - TaskFlow API</title>
    <style>
        :root { --blue: #466eea; --green: #25d366; --red: #ff4444; --bg: #121212; --card: #1e1e1e; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; padding: 10px; }
        .container { max-width: 450px; margin: auto; background: var(--card); border-radius: 20px; border: 1px solid #333; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* LOGIN / BLOQUEO */
        #bloqueo { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        
        .tabs { display: flex; background: #000; overflow-x: auto; border-bottom: 1px solid #333; }
        .tabs button { flex: 1; padding: 15px; border: none; color: #666; background: none; cursor: pointer; font-weight: bold; font-size: 10px; text-transform: uppercase; min-width: 80px; }
        .tabs button.active { color: var(--blue); border-bottom: 2px solid var(--blue); }
        
        .content { padding: 15px; }
        .section { display: none; }
        .section.active { display: block; }

        input { width: 100%; padding: 12px; margin: 6px 0; border-radius: 10px; border: 1px solid #333; background: #2d2d2d; color: white; box-sizing: border-box; }
        .btn { width: 100%; padding: 15px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .btn-blue { background: var(--blue); color: white; }

        /* TASKFLOW API */
        .task-item { background: #252525; padding: 12px; border-radius: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--blue); }
        .task-item.done { border-left-color: var(--green); opacity: 0.5; }
        .task-item span { flex: 1; font-size: 14px; margin-right: 10px; }
        .task-item.done span { text-decoration: line-through; color: #888; }
        .t-btn { padding: 5px 10px; border-radius: 6px; border: none; cursor: pointer; }

        /* CAJA */
        .card-info { background: #252525; padding: 15px; border-radius: 12px; margin-top: 10px; border-left: 4px solid var(--blue); }
        .card-info h2 { margin: 5px 0; font-size: 22px; color: var(--green); }
    </style>
</head>
<body>

    <div id="bloqueo">
        <h1 style="color:var(--red)">üîí LICENCIA EXPIRADA</h1>
        <input type="text" id="key-input" style="width: 80%; text-align: center;" placeholder="C√≥digo Anual">
        <button class="btn btn-blue" onclick="activar()" style="width: 80%;">ACTIVAR</button>
    </div>

    <div class="container">
        <div class="tabs">
            <button class="active" onclick="tab('tareas', event)">TaskFlow</button>
            <button onclick="tab('venta', event)">Venta</button>
            <button onclick="tab('caja', event)">Caja</button>
        </div>

        <div class="content">
            <div id="tareas" class="section active">
                <h3 style="color: var(--blue); margin: 0 0 10px 0;">Tareas Pendientes</h3>
                <input type="text" id="in-tarea" placeholder="Escriba una tarea...">
                <button class="btn btn-blue" onclick="addTarea()">AGREGAR TAREA</button>
                <div id="lista-tareas" style="margin-top: 15px;"></div>
            </div>

            <div id="venta" class="section">
                <input type="text" id="cli" placeholder="Cliente">
                <input type="number" id="pre" placeholder="Precio Total $">
                <button class="btn btn-blue" onclick="registrarVenta()">GUARDAR VENTA</button>
            </div>

            <div id="caja" class="section">
                <div class="card-info"><small>TOTAL MES</small><h2 id="m-val">$ 0</h2></div>
                <div class="card-info"><small>TOTAL A√ëO</small><h2 id="a-val">$ 0</h2></div>
            </div>
        </div>
    </div>

<script>
    const CLAVE_MAESTRA = "VENTAS-2026-PRO";

    // 1. SEGURIDAD LOGIN
    function checkLicencia() {
        let v = localStorage.getItem('APP_VENC');
        if (!v) { 
            let d = new Date(); d.setFullYear(d.getFullYear() + 1); 
            localStorage.setItem('APP_VENC', d.toISOString()); 
            v = d.toISOString();
        }
        if (new Date() > new Date(v)) document.getElementById('bloqueo').style.display = 'flex';
    }

    function activar() {
        if(document.getElementById('key-input').value === CLAVE_MAESTRA) {
            let d = new Date(); d.setFullYear(d.getFullYear() + 1);
            localStorage.setItem('APP_VENC', d.toISOString());
            location.reload();
        }
    }

    // 2. API TASKFLOW (TAREAS)
    function addTarea() {
        const val = document.getElementById('in-tarea').value;
        if(!val) return;
        let db = JSON.parse(localStorage.getItem('TASK_API')) || [];
        db.push({ id: Date.now(), txt: val, status: false });
        localStorage.setItem('TASK_API', JSON.stringify(db));
        document.getElementById('in-tarea').value = "";
        actualizar();
    }

    function toggleTarea(id) {
        let db = JSON.parse(localStorage.getItem('TASK_API'));
        db = db.map(x => { if(x.id === id) x.status = !x.status; return x; });
        localStorage.setItem('TASK_API', JSON.stringify(db));
        actualizar();
    }

    function borrarTarea(id) {
        let db = JSON.parse(localStorage.getItem('TASK_API')).filter(x => x.id !== id);
        localStorage.setItem('TASK_API', JSON.stringify(db));
        actualizar();
    }

    // 3. ACTUALIZAR TODO
    function registrarVenta() {
        const pre = document.getElementById('pre').value;
        if(!pre) return;
        let v = JSON.parse(localStorage.getItem('VENTAS_DB')) || [];
        v.push({ pre: Number(pre), f: new Date().toISOString() });
        localStorage.setItem('VENTAS_DB', JSON.stringify(v));
        actualizar();
        alert("Venta guardada");
    }

    function actualizar() {
        const t = JSON.parse(localStorage.getItem('TASK_API')) || [];
        const v = JSON.parse(localStorage.getItem('VENTAS_DB')) || [];
        
        // Render Tareas
        document.getElementById('lista-tareas').innerHTML = t.map(x => `
            <div class="task-item ${x.status ? 'done' : ''}">
                <span>${x.txt}</span>
                <div style="display:flex; gap:5px;">
                    <button class="t-btn" style="background:var(--green)" onclick="toggleTarea(${x.id})">‚úÖ</button>
                    <button class="t-btn" style="background:var(--red); color:white" onclick="borrarTarea(${x.id})">üóëÔ∏è</button>
                </div>
            </div>`).join('');

        // Render Caja (Suma correcta)
        const hoy = new Date(); let mes = 0, anio = 0;
        v.forEach(x => {
            let f = new Date(x.f), monto = Number(x.pre) || 0;
            if(f.getFullYear() === hoy.getFullYear()) {
                anio += monto;
                if(f.getMonth() === hoy.getMonth()) mes += monto;
            }
        });
        document.getElementById('m-val').innerText = "$ " + mes.toLocaleString();
        document.getElementById('a-val').innerText = "$ " + anio.toLocaleString();
    }

    function tab(id, e) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        e.target.classList.add('active');
    }

    window.onload = () => { checkLicencia(); actualizar(); };
</script>
</body>
</html>
